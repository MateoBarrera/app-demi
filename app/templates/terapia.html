{% extends 'base.html' %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block title %}
{{ super() }}
Iniciar Terapia
{% endblock %}

{% block navbar %}
{% include 'navbar_2.html' %}
{% endblock %}

{% block content %}

<section id="iniciar_terapia" class="contact-section contact-style-6">
  <div class="container justify-content-center">
    <div class="row">
    <div class="col-lg-5">
      <div class="content-wrapper">
        <div class="section-title mb-40">
          {% if rol != 'est' %}
            <h2 >Bienvenido</h2>
            <h3 class="mb-60">{{ data.nombre | capitalize }}</h3>
          {% else %}
            <h3 class="mb-60">Información del estudiante</h3>
          {% endif %}
          <div class="contact-form-wrapper">
            {% if rol == 'inv/doc' %}
            <form autocomplete="off" action="{{ url_for('iniciar_terapia') }}" method="POST">
              <fieldset>
                <h4>Información de la sesión</4>
                <div class="select-input">
                  {{ terapia_form.csrf_token() }}
                  <label for="name s">
                    <h6>{{ terapia_form.nombre_form.label() }}</h6>
                  </label>
                  {{ terapia_form.nombre_form(class_="d-flex justify-content-end") }}
                  <select name="nombre_select" onchange="set_values()" id="nombre"></select>
                </div>
              </fieldset>
              <fieldset>
                <div class="single-input">
                  <label for="institucion s">
                    <h6>Institución Educativa</h6>
                  </label>
                  <input name="text_inst" type="text" readonly id="institucion" class="form-input">
                </div>
              </fieldset>
              <fieldset>
                <div class="single-input">
                  <label for="grado s">
                    <h6>Grado Escolar</h6>
                  </label>
                  <input name="text_grado" type="text" readonly id="grado" class="form-input">
                </div>
              </fieldset>
              <fieldset>
                <div class="select-input">
                  <h4 class="mt-20">Evaluación Inicial</4>
                  <label for="grado s">
                    <h6>{{terapia_form.emocion_percibida.label()}}</h6>
                  </label>
                  {{terapia_form.emocion_percibida()}}
                  {% for error in terapia_form.emocion_percibida.errors %}
                  <span style="color: red;">{{ error }}</span>
                  {% endfor %}
                </div>
              </fieldset>
              <fieldset>
                <div class="single-input">
                  <label for="grado s">
                    <h6>Tipo de sesión</h6>
                  </label>
                </div>
                <div class="d-flex justify-content-center">
                  <div class="altern-text form-check form-check-inline mr-50">
                    <h6>Presencial</h6>
                  </div>
                  <div class="form-check form-check-inline form-switch">
                    {{terapia_form.virtual(class_="col form-check-input")}}
                  </div>
                  <div class="altern-text form-check form-check-inline">
                    <h6>Virtual</h6>
                  </div>
                </div>
              </fieldset>
              <fieldset>
                <div class="mt-50">
                  {{terapia_form.iniciar(class_="form-button button radius-10 w-100")}}
                  {% for error in terapia_form.errors %}
                  <span style="color: red;">El error es {{ error }}</span>
                  {% endfor %}
                </div>
              </fieldset>
            </form>
            {% else %}
            <form>
              <fieldset>
                <div class="single-input ">
                  <label for="grado s">
                    <h6>Grado Escolar</h6>
                  </label>
                  <input type="text" readonly id="grado_est" class="form-input text-center" value="{{data.grado}}">
                  
                </div>
              </fieldset>
              <fieldset>
                <div class="single-input">
                  <label for="institucion s">
                    <h6>Institución Educativa</h6>
                  </label>
                  <input type="text" readonly id="institucion_est" class="form-input text-center" value="{{data.institucion|upper }}">
                </div>
              </fieldset>
              <fieldset>
                <div class="text-center form-button wow fadeInUp">
                  <a href="{{url_for('script.ventana_carga')}}"><button type="button" class="button radius-10">Iniciar</button></a>
                </div>
              </fieldset>
            </from>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-5 ml-auto p-auto">
      <div class="hero-image cup-end">
        <img src="{{url_for('static',filename='/images/Reading_book.svg')}}" alt="" class="wow fadeInRight"
          data-wow-delay=".2s"
          style="visibility: visible; animation-delay: 0.2s; animation-name: fadeInRight; max-width: 100%; ">
      </div>
    </div>
    </div>
  </div>
  {% if rol == 'inv/doc' %}
  <div class="container">
    <div class="row" style="margin-top: 100px;">
      <div class="col-md-12">
          <div class="section-title mb-60 ">
            <h6 class="text-center mb-15 wow fadeInUp" data-wow-delay=".2s">¿Estudiante nuevo?</h6>
            <div class="text-center form-button wow fadeInUp">
              <a href="{{url_for('registro_est',terapia=True)}}"><button type="button" class="button radius-10">Registrar</button></a>
            </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</section>

{% endblock %}

{% block scripts%}
{{super()}}

<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.js">
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.js">
</script> -->

 <script type="text/javascript">
      window.onload = function () {
      /* alert("Page is loaded"); */
      console.log("AQUI VAA")
      var x = document.getElementById("nombre");
      var option = document.createElement("option");
      option.text = "";
      x.add(option);
      {% for student in students %}
      var option = document.createElement("option");
      option.text = "{{ student['estudiante']| upper }}";
      x.add(option);
      {% endfor %}
    }
    
  


  function set_values() {
    var index = document.getElementById("nombre");
    var name_std = index.options[index.selectedIndex].text;

    console.log("input")
    console.log(name_std)
    var inst = "";
    var grado = "";
    {% for student in students %}

      console.log("{{student['estudiante']|upper}}")
      if ("{{student['estudiante']|upper}}" == name_std) {
        console.log("si hay")
        var inst = "{{student['institucion']}}";
        var grado = "{{student['grado']}}";
      }
    {% endfor %}
  console.log(inst)
  console.log(grado)
  console.log("fin")
  document.getElementById("nombre_form").value = name_std;
  document.getElementById("institucion").value = inst;
  document.getElementById("grado").value = grado;

  }

</script>



{% endblock %}
{%block footer%}
{% include 'footer.html' %}
{% endblock %}